

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; phpcassa v1.0.a.2 documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.a.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="phpcassa v1.0.a.2 documentation" href="index.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Installing" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installing"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">phpcassa v1.0.a.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#creating-a-keyspace-and-column-families">Creating a Keyspace and Column Families</a></li>
<li><a class="reference internal" href="#autoload-and-imports">Autoload and Imports</a></li>
<li><a class="reference internal" href="#making-a-connection">Making a Connection</a></li>
<li><a class="reference internal" href="#getting-a-columnfamily">Getting a ColumnFamily</a></li>
<li><a class="reference internal" href="#inserting-data">Inserting Data</a></li>
<li><a class="reference internal" href="#getting-data">Getting Data</a></li>
<li><a class="reference internal" href="#removing-data">Removing Data</a></li>
<li><a class="reference internal" href="#counting">Counting</a></li>
<li><a class="reference internal" href="#super-columns">Super Columns</a></li>
<li><a class="reference internal" href="#typed-column-names-and-values">Typed Column Names and Values</a></li>
<li><a class="reference internal" href="#indexes">Indexes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="troubleshooting.html"
                        title="next chapter">Troubleshooting</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is intended as an introduction to working with
Cassandra and phpcassa.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before we start, make sure that you have phpcassa
<a class="reference internal" href="installation.html"><em>installed</em></a>.</p>
<p>This tutorial also assumes that a Cassandra instance is running on the
default host and port. Read the <a class="reference external" href="http://wiki.apache.org/cassandra/GettingStarted">instructions for getting started
with Cassandra</a>.
You can start Cassandra like so:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">pwd</span>
~/cassandra
<span class="nv">$ </span>bin/cassandra -f
</pre></div>
</div>
</div>
<div class="section" id="creating-a-keyspace-and-column-families">
<h2>Creating a Keyspace and Column Families<a class="headerlink" href="#creating-a-keyspace-and-column-families" title="Permalink to this headline">¶</a></h2>
<p>We need to create a keyspace and some column families to work with.</p>
<p>The cassandra-cli utility is included with Cassandra; it allows you to create
and modify the schema, explore or modify data, and examine a few things about
your cluster.  Here&#8217;s how to create the keyspace and column family we need
for this tutorial:</p>
<div class="highlight-none"><div class="highlight"><pre>user@~ $ cassandra-cli
Welcome to cassandra CLI.

Type &#39;help;&#39; or &#39;?&#39; for help. Type &#39;quit;&#39; or &#39;exit;&#39; to quit.
[default@unknown] connect localhost/9160;
Connected to: &quot;Test Cluster&quot; on localhost/9160
[default@unknown] create keyspace Keyspace1;
4f9e42c4-645e-11e0-ad9e-e700f669bcfc
Waiting for schema agreement...
... schemas agree across the cluster
[default@unknown] use Keyspace1;
Authenticated to keyspace: Keyspace1
[default@Keyspace1] create column family ColumnFamily1;
632cf985-645e-11e0-ad9e-e700f669bcfc
Waiting for schema agreement...
... schemas agree across the cluster
[default@Keyspace1] quit;
user@~ $
</pre></div>
</div>
<p>This connects to a local instance of Cassandra and creates a keyspace
named &#8216;Keyspace1&#8217; with a column family named &#8216;ColumnFamily1&#8217;.</p>
</div>
<div class="section" id="autoload-and-imports">
<h2>Autoload and Imports<a class="headerlink" href="#autoload-and-imports" title="Permalink to this headline">¶</a></h2>
<p>You can bootstrap the PHP autoloader to easily import phpcassa
classes by requiring or including <tt class="file docutils literal"><span class="pre">lib/phpcassa/autoload.php</span></tt>.</p>
<p>To start the tutorial, require the bootstrap file in one way or
another and import a couple of classes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">require</span><span class="p">(</span><span class="s1">&#39;lib/phpcassa/autoload.php&#39;</span><span class="p">);</span>

    <span class="k">use</span> <span class="nx">phpcassa\ColumnFamily</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">phpcassa\ColumnSlice</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">phpcassa\Connection\ConnectionPool</span><span class="p">;</span>

    <span class="c1">// tutorial code starts here</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="making-a-connection">
<h2>Making a Connection<a class="headerlink" href="#making-a-connection" title="Permalink to this headline">¶</a></h2>
<p>The first step when working with phpcassa is to create a
<a class="reference external" href="api/phpcassa/connection/ConnectionPool">ConnectionPool</a> which
will connect to the Cassandra instance(s):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConnectionPool</span><span class="p">(</span><span class="s2">&quot;Keyspace&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above code will connect on the default host and port. We can also
specify a list of &#8216;host:port&#8217; combinations like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$servers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;192.168.2.1:9160&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.2.2:9160&quot;</span><span class="p">);</span>
<span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConnectionPool</span><span class="p">(</span><span class="s2">&quot;Keyspace1&quot;</span><span class="p">,</span> <span class="nv">$servers</span><span class="p">);</span>
</pre></div>
</div>
<p>If omitted, the port defaults to 9160.</p>
</div>
<div class="section" id="getting-a-columnfamily">
<h2>Getting a ColumnFamily<a class="headerlink" href="#getting-a-columnfamily" title="Permalink to this headline">¶</a></h2>
<p>A column family is a collection of rows and columns in Cassandra,
and can be thought of as roughly the equivalent of a table in a
relational database. We&#8217;ll use one of the column families that
were already included in the schema file:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnFamily</span><span class="p">(</span><span class="nv">$pool</span><span class="p">,</span> <span class="s1">&#39;ColumnFamily1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="inserting-data">
<h2>Inserting Data<a class="headerlink" href="#inserting-data" title="Permalink to this headline">¶</a></h2>
<p>To insert a row into a column family we can use the
<a class="reference external" href="api/phpcassa/columnfamily/ColumnFamily#insert">ColumnFamily::insert()</a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;col_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;col_val&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>We can also insert more than one column at a time:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;name2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;val2&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>And we can insert more than one row at a time:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$row1</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;name2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;val2&#39;</span><span class="p">);</span>
<span class="nv">$row2</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">batch_insert</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;row1&#39;</span> <span class="o">=&gt;</span> <span class="nv">$row1</span><span class="p">,</span> <span class="s1">&#39;row2&#39;</span> <span class="o">=&gt;</span> <span class="nv">$row2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-data">
<h2>Getting Data<a class="headerlink" href="#getting-data" title="Permalink to this headline">¶</a></h2>
<p>There are many more ways to get data out of Cassandra than there are
to insert data.</p>
<p>The simplest way to get data is to use
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_get">ColumnFamily::get()</a></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;colname&#39; =&gt; &#39;col_val&#39;)</span>
</pre></div>
</div>
<p>Without any other arguments, <tt class="xref py py-meth docutils literal"><span class="pre">ColumnFamily::get()</span></tt>
returns every column in the row (up to <cite>$column_count</cite>, which defaults to 100).
If you only want a few of the columns and you know them by name, you can
specify them using a <cite>$column_names</cite> argument:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_names</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name1&#39;</span><span class="p">,</span> <span class="s1">&#39;name2&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="nv">$column_slice</span><span class="o">=</span><span class="k">null</span><span class="p">,</span> <span class="nv">$column_names</span><span class="o">=</span><span class="nv">$column_names</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;name1&#39; =&gt; &#39;foo&#39;, &#39;name2&#39; =&gt; &#39;bar&#39;)</span>
</pre></div>
</div>
<p>We may also get a slice (or subrange) or the columns in a row. To do this,
we need to make a <a class="reference external" href="api/class-phpcassa.ColumnSlice.html">ColumnSlice</a> object.</p>
<p>The first two parameters are <cite>$start</cite> and <cite>$finish</cite>.  One or both of these may
be left as empty strings to allow the slice to extend to one or both ends of
the row.</p>
<p>Assuming we&#8217;ve inserted several
columns with names &#8216;1&#8217; through &#8216;9&#8217;, we can do the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$slice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnSlice</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="nv">$slice</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;5&#39; =&gt; &#39;foo&#39;, &#39;6&#39; =&gt; &#39;bar&#39;, &#39;7&#39; =&gt; &#39;baz&#39;)</span>
</pre></div>
</div>
<p>There are also two ways to get multiple rows at the same time.
The first is to specify them by name using
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_multiget">ColumnFamily::multiget()</a></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">multiget</span><span class="p">([</span><span class="s1">&#39;row_key1&#39;</span><span class="p">,</span> <span class="s1">&#39;row_key2&#39;</span><span class="p">]);</span>
<span class="c1">// returns: array(&#39;row_key1&#39; =&gt; array(&#39;name&#39; =&gt; &#39;val&#39;), &#39;row_key2&#39; =&gt; array(&#39;name&#39; =&gt; &#39;val&#39;))</span>
</pre></div>
</div>
<p>The other way is to get a range of keys at once by using
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_get_range">ColumnFamily::get_range()</a>
The parameter <cite>$key_finish</cite> is also inclusive here, too.  Assuming we&#8217;ve inserted
some rows with keys &#8216;row_key1&#8217; through &#8216;row_key9&#8217;, we can do this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get_range</span><span class="p">(</span><span class="nv">$key_start</span><span class="o">=</span><span class="s1">&#39;row_key5&#39;</span><span class="p">,</span> <span class="nv">$key_finish</span><span class="o">=</span><span class="s1">&#39;row_key7&#39;</span><span class="p">);</span>
<span class="c1">// returns an Iterator over:</span>
<span class="c1">// array(&#39;row_key5&#39; =&gt; array(&#39;name&#39; =&gt; &#39;val&#39;),</span>
<span class="c1">//       &#39;row_key6&#39; =&gt; array(&#39;name&#39; =&gt; &#39;val&#39;),</span>
<span class="c1">//       &#39;row_key7&#39; =&gt; array(&#39;name&#39; =&gt; &#39;val&#39;))</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$columns</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do stuff with $key or $columns</span>
    <span class="nx">Print_r</span><span class="p">(</span><span class="nv">$columns</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cassandra must be using an OrderPreservingPartitioner for you to be
able to get a meaningful range of rows; the default, RandomPartitioner,
stores rows in the order of the MD5 hash of their keys. See
<a class="reference external" href="http://www.datastax.com/docs/1.0/cluster_architecture/partitioning">http://www.datastax.com/docs/1.0/cluster_architecture/partitioning</a>.</p>
</div>
<p>It&#8217;s also possible to specify a set of columns or a slice for
<cite>multiget()</cite> and <cite>get_range()</cite> just like we did for <cite>get()</cite>.</p>
</div>
<div class="section" id="removing-data">
<h2>Removing Data<a class="headerlink" href="#removing-data" title="Permalink to this headline">¶</a></h2>
<p>You may remove data from a column family with
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_remove">ColumnFamily::remove()</a>.</p>
<p>You can remove an entire row at once:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Or a specific set of columns from a row:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>You cannot remove a slice of columns from a row.</p>
</div>
<div class="section" id="counting">
<h2>Counting<a class="headerlink" href="#counting" title="Permalink to this headline">¶</a></h2>
<p>If you just want to know how many columns are in a row, you can use
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_get_count">ColumnFamily::get_count()</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">);</span>
<span class="c1">// returns: 3</span>
</pre></div>
</div>
<p>If you only want to get a count of the number of columns that are inside
of a slice or have particular names, you can do that as well:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_names</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="nv">$column_slice</span><span class="o">=</span><span class="k">null</span><span class="p">,</span> <span class="nv">$column_names</span><span class="o">=</span><span class="nv">$column_names</span><span class="p">);</span>
<span class="c1">// returns: 2</span>

<span class="nv">$slice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnSlice</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="nv">$slice</span><span class="p">);</span>
<span class="c1">// returns: 3</span>
</pre></div>
</div>
<p>You can also do this in parallel for multiple rows using
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#_multiget_count">ColumnFamily::multiget_count()</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">multiget_count</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fib0&#39;</span><span class="p">,</span> <span class="s1">&#39;fib1&#39;</span><span class="p">,</span> <span class="s1">&#39;fib2&#39;</span><span class="p">,</span> <span class="s1">&#39;fib3&#39;</span><span class="p">,</span> <span class="s1">&#39;fib4&#39;</span><span class="p">));</span>
<span class="c1">// returns: array(&#39;fib0&#39; =&gt; 1, &#39;fib1&#39; =&gt; 1, &#39;fib2&#39; =&gt; 2, &#39;fib3&#39; =&gt; 3, &#39;fib4&#39; =&gt; 5)</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$names</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">,</span> <span class="s1">&#39;col3&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">multiget_count</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fib0&#39;</span><span class="p">,</span> <span class="s1">&#39;fib1&#39;</span><span class="p">,</span> <span class="s1">&#39;fib2&#39;</span><span class="p">,</span> <span class="s1">&#39;fib3&#39;</span><span class="p">,</span> <span class="s1">&#39;fib4&#39;</span><span class="p">),</span>
                               <span class="nv">$column_slice</span><span class="o">=</span><span class="k">null</span><span class="p">,</span> <span class="nv">$column_names</span><span class="o">=</span><span class="nv">$names</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;fib0&#39; =&gt; 1, &#39;fib1&#39; =&gt; 1, &#39;fib2&#39; =&gt; 2, &#39;fib3&#39; =&gt; 3, &#39;fib4&#39; =&gt; 3)</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$slice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnSlice</span><span class="p">(</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col3&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">multiget_count</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fib0&#39;</span><span class="p">,</span> <span class="s1">&#39;fib1&#39;</span><span class="p">,</span> <span class="s1">&#39;fib2&#39;</span><span class="p">,</span> <span class="s1">&#39;fib3&#39;</span><span class="p">,</span> <span class="s1">&#39;fib4&#39;</span><span class="p">),</span> <span class="nv">$slice</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;fib0&#39; =&gt; 1, &#39;fib1&#39; =&gt; 1, &#39;fib2&#39; =&gt; 2, &#39;fib3&#39; =&gt; 3, &#39;fib4&#39; =&gt; 3)</span>
</pre></div>
</div>
</div>
<div class="section" id="super-columns">
<h2>Super Columns<a class="headerlink" href="#super-columns" title="Permalink to this headline">¶</a></h2>
<p>Cassandra allows you to group columns in &#8220;super columns&#8221; when using
super column families.  You can create a super column family using
cassandra-cli like this:</p>
<div class="highlight-none"><div class="highlight"><pre>[default@Keyspace1] create column family Super1 with column_type=Super;
632cf985-645e-11e0-ad9e-e700f669bcfc
</pre></div>
</div>
<p>To use a super columns in phpcassa, you need to create an instance
of <tt class="docutils literal"><span class="pre">phpcassa\SuperColumnFamily</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">phpcassa\SuperColumnFamily</span><span class="p">;</span>


<span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SuperColumnFamily</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s1">&#39;Super1&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;supercol_name&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;col_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;col_val&#39;</span><span class="p">)));</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;supercol_name&#39; =&gt; (&#39;col_name&#39; =&gt; &#39;col_val&#39;))</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">remove_super_column</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="s1">&#39;supercolumn_name&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="typed-column-names-and-values">
<h2>Typed Column Names and Values<a class="headerlink" href="#typed-column-names-and-values" title="Permalink to this headline">¶</a></h2>
<p>In Cassandra, you can specify a comparator type for column names
and a validator type for row keys and column values.</p>
<p>There are
<a class="reference external" href="api/namespace-phpcassa.Schema.DataType.html">several types supported by default</a>.</p>
<p>The column name comparator types affect how columns are sorted within
a row. You can use these with standard column families as well as with
super column families; with super column families, the subcolumns may
even have a different comparator type.</p>
<p>Cassandra requires clients to pack these types into a binary format it
can understand.  When phpcassa sees that a column family uses these types,
it knows to pack and unpack these data types automatically.
So, if we want to write to the StandardInt column family, we can do
the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnFamily</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s1">&#39;StandardInt&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">42</span> <span class="o">=&gt;</span> <span class="s1">&#39;some_val&#39;</span><span class="p">));</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">)</span>
<span class="c1">// returns: array(42 =&gt; &#39;some_val&#39;)</span>
</pre></div>
</div>
<p>Notice that 42 is an integer here, not a string.</p>
<p>As mentioned above, Cassandra also offers validators on column values with
the same set of types.  Validators can be set for an entire column family,
for individual columns, or both:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnFamily</span><span class="p">(</span><span class="nv">$pool</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">)</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;joe&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">23</span><span class="p">));</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;row_key&#39;</span><span class="p">);</span>
<span class="c1">// returns: array(&#39;name&#39; =&gt; &#39;joe&#39;, &#39;age&#39; =&gt; 23)</span>
</pre></div>
</div>
<p>Of course, if phpcassa&#8217;s automatic behavior isn&#8217;t working for you, you
can turn it off with
<a class="reference external" href="api/class-phpcassa.ColumnFamily.html#$autopack_names">ColumnFamily::$autopack_names</a>
and the other <cite>$autopack</cite> attributes.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnFamily</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s1">&#39;ColumnFamily1&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="nv">$autopack_names</span><span class="o">=</span><span class="k">False</span><span class="p">;</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="nv">$autopack_values</span><span class="o">=</span><span class="k">False</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="indexes">
<h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<p>Cassandra supports built-in secondary indexes, which allow you to
efficiently get only rows which match a certain expression.</p>
<p>In order to use
<a class="reference external" href="api/class-phpcassa.ColumnFamily#_get_indexed_slices">ColumnFamily::get_indexed_slices()</a>
, we need to create an
<a class="reference external" href="api/class-phpcassa.Index.IndexClause">IndexClause</a>
which contains a list of
<a class="reference external" href="api/class-phpcassa.Index.IndexExpression">IndexExpression</a>
objects.</p>
<p>Suppose we are only interested in rows where &#8216;birthdate&#8217; is 1984. We might do
the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">phpcassa\SystemManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">phpcassa\Index\IndexExpression</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">phpcassa\Index\IndexClause</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">phpcassa\Schema\DataType\LongType</span><span class="p">;</span>

<span class="nv">$sys</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SystemManager</span><span class="p">();</span>
<span class="nv">$sys</span><span class="o">-&gt;</span><span class="na">create_column_family</span><span class="p">(</span><span class="s1">&#39;Keyspace&#39;</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">);</span>
<span class="nv">$sys</span><span class="o">-&gt;</span><span class="na">create_index</span><span class="p">(</span><span class="s1">&#39;Keyspace&#39;</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="s1">&#39;birthdate&#39;</span><span class="p">,</span> <span class="nx">LongType</span><span class="p">());</span>

<span class="nv">$column_family</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColumnFamily</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">);</span>
<span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;winston&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;birthdate&#39;</span> <span class="o">=&gt;</span> <span class="mi">1984</span><span class="p">));</span>

<span class="nv">$index_exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IndexExpression</span><span class="p">(</span><span class="s1">&#39;birthdate&#39;</span><span class="p">,</span> <span class="mi">1984</span><span class="p">);</span>
<span class="nv">$index_clause</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IndexClause</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$index_exp</span><span class="p">));</span>
<span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$column_family</span><span class="o">-&gt;</span><span class="na">get_indexed_slices</span><span class="p">(</span><span class="nv">$index_clause</span><span class="p">);</span>
<span class="c1">// returns an Iterator over:</span>
<span class="c1">//    array(&#39;winston smith&#39; =&gt; array(&#39;birthdate&#39; =&gt; 1984))</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$columns</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do stuff with $key and $columns</span>
    <span class="nx">Print_r</span><span class="p">(</span><span class="nv">$columns</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although at least one <cite>IndexExpression</cite> in every clause must use an equality
match against an indexed column, you may also have other expressions which are
apply to non-indexed columns or use comparators other than <cite>&#8220;EQ&#8221;</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installing"
             >previous</a> |</li>
        <li><a href="index.html">phpcassa v1.0.a.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>